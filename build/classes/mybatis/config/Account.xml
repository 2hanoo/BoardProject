<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.config.Account">
	<!-- 검색 부분 -->
	<sql id="search">
		<where>
			<if test="keyWord!=null and keyWord!=''">
				<if test="keyField=='writer'">
					writer like '%${keyWord}%'
				</if>
				<if test="keyField=='title'">
					title like '%${keyWord}%'
				</if>
				<if test="keyField=='content'">
					content like '%${keyWord}%'
				</if>
			</if>
		</where>
	</sql>
	<!-- 전체 레코드 수 -->
	<select id="getTotalCount" resultType="int">
		select count(*) from BOARD
		<include refid="search" />
	</select>
	<!-- 전체보기 -->
	<select id="listBoard" resultType="bo" parameterType="map">
		select * from (select rownum as rnum, tem.* from (select * from BOARD
		<include refid="search" />
		order by groups desc, step asc) tem) where rnum between #{startRow}
		and #{endRow}
	</select>


	<!-- seq 최대값 -->
	<select id="getMaxSeq" resultType="int">
		select max(seq) from BOARD
	</select>

	<!-- 글쓰기 -->
	<insert id="insertBoard" parameterType="bo">
		insert into BOARD
		values(boardseq.nextval, #{writer}, #{title}, #{content},
		#{pwd}, 0,
		#{groups}, #{step}, #{levels}, sysdate)
	</insert>

	<!-- 조회수 증가 -->
	<update id="updateHit" parameterType="int">
		update board SET hit = hit
		+ 1 where seq = #{seqarg}
	</update>

	<!-- 글 읽기 -->
	<select id="detailBoard" resultType="bo" parameterType="int">
		select *
		from BOARD where seq = #{seqarg}
	</select>

	<!-- 글 수정 -->
	<update id="update" parameterType="bo">
		update BOARD set writer =
		#{writer}, title = #{title}, content = #{content},
		pwd = #{pwd},
		regdate = sysdate where seq = #{seq}
	</update>

	<!-- 글 삭제 -->
	<delete id="deleteBoard" parameterType="int">
		delete board where seq =
		#{seqarg}
	</delete>

	<!-- 답글 등록 -->
	<update id="updateStep" parameterType="map">
		update BOARD set step = step+1 where groups = #{groups} and step > #{step}
	</update>

</mapper>	

